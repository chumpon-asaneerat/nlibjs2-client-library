<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>Home Page.</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/ico" href="public/favicon.ico"/>

    <!-- Font Awesome -->
    <link href="/dist/css/fontawesome.all.min.css" rel="stylesheet" type="text/css" />
    <!-- JQuery UI -->
    <link href="/dist/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
    <!-- Bootstrap 4 -->
    <link href="/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/dist/css/bootstrap-grid.min.css" rel="stylesheet" type="text/css" />
    <link href="/dist/css/bootstrap-reboot.min.css" rel="stylesheet" type="text/css" />
    <!-- Flag and Emoji icons -->
    <link href="/dist/css/flag-icon.min.css" rel="stylesheet" type="text/css" />
    <link href="/dist/css/emojisymbol.min.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <div class="container-fluid m-0 m-auto">
        <h3>Font awesome sample</h3>
        <p><i class="fas fa-arrow-right">&nbsp;&nbsp;</i>Sample icon</p>
        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>User Register/Sign In/Sign Out</h3>
        <input type="text" id="userName" value="joe@example.com">
        <input type="text" id="passWord" value="1234">
        <p id="userStatus">Status: </p>
        <button onclick="userRegister();">Register</button>
        <button onclick="userSignIn();">Sign In</button>
        <button onclick="userSignOut();">Sign Out</button>
        <hr>
    </div>

    <div class="container-fluid m-0 m-auto">
        <h3>Device Register/Sign In/Sign Out</h3>
        <p id="deviceStatus">Status: </p>
        <button onclick="deviceRegister();">Register</button>
        <button onclick="userSignIn();">Sign In</button>
        <button onclick="deviceSignOut();">Sign Out</button>
        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Load image from static route</h3>
        <br>
        <br>
        <img src="/public/assets/images/gif/emoji/transparent/emo-nt-01.gif" 
            height="auto" width="auto" 
            style="display: block; margin-left: auto; margin-right: auto;">
        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Load image from XHR</h3>
        <button onclick="getImage(0);">Get image 1</button>
        <button onclick="getImage(1);">Get image 2</button>
        <button onclick="getImage(2);">Get image 3</button>
        <br>
        <button onclick="getImage(3);">Get emoji 01</button>
        <button onclick="getImage(4);">Get emoji 02</button>
        <button onclick="getImage(5);">Get emoji 03</button>
        <button onclick="getImage(6);">Get emoji 04</button>
        <button onclick="getImage(7);">Get emoji 05</button>
        <br>
        <button onclick="getImage(8);">Get emoji 06</button>
        <button onclick="getImage(9);">Get emoji 07</button>
        <button onclick="getImage(10);">Get emoji 08</button>
        <button onclick="getImage(11);">Get emoji 09</button>
        <button onclick="getImage(12);">Get emoji 10</button>
        <br>
        <button onclick="getImage(13);">Get emoji 11</button>
        <button onclick="getImage(14);">Get emoji 12</button>
        <button onclick="getImage(15);">Get emoji 13</button>
        <button onclick="getImage(16);">Get emoji 14</button>
        <button onclick="getImage(17);">Get emoji 15</button>
        <br>
        <button onclick="getImage(18);">Get emoji 16</button>
        <button onclick="getImage(19);">Get emoji 17</button>
        <button onclick="getImage(20);">Get emoji 18</button>
        <button onclick="getImage(21);">Get emoji 19</button>
        <button onclick="getImage(22);">Get emoji 20</button>
        <br>
        <button onclick="getImage(23);">Get emoji 21</button>
        <button onclick="getImage(24);">Get emoji 22</button>
        <button onclick="getImage(25);">Get emoji 23</button>
        <button onclick="getImage(26);">Get emoji 24</button>
        <button onclick="getImage(27);">Get emoji 25</button>
        <br>
        <button onclick="getImage(28);">Get emoji 26</button>
        <button onclick="getImage(29);">Get emoji 27</button>
        <button onclick="getImage(30);">Get emoji 28</button>
        <button onclick="getImage(31);">Get emoji 29</button>
        <button onclick="getImage(32);">Get emoji 30</button>
        <br>
        <button onclick="getImage(33);">Get emoji 31</button>
        <button onclick="getImage(34);">Get emoji 32</button>
        <button onclick="getImage(35);">Get emoji 33</button>
        <button onclick="getImage(36);">Get emoji 34</button>
        <button onclick="getImage(37);">Get emoji 35</button>
        <br>
        <button onclick="getImage(38);">Get emoji 36</button>
        <button onclick="getImage(39);">Get emoji 37</button>
        <button onclick="getImage(40);">Get emoji 38</button>
        <button onclick="getImage(41);">Get emoji 39</button>
        <button onclick="getImage(42);">Get emoji 40</button>
        <br>
        <button onclick="getImage(43);">Get emoji 41</button>
        <button onclick="getImage(44);">Get emoji 42</button>
        <button onclick="getImage(45);">Get emoji 43</button>
        <button onclick="getImage(46);">Get emoji 44</button>
        <button onclick="getImage(47);">Get emoji 45</button>
        <br>
        <button onclick="getImage(48);">Get emoji 46</button>
        <button onclick="getImage(49);">Get emoji 47</button>
        <br>
        <br>
        <img id="img1" src="" 
            height="150px" width="auto" 
            style="display: block; margin-left: auto; margin-right: auto;">

        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Upload files (Use multipart/form-data)</h3>
        <!-- MULTIPLE FILES -->
        <form action="/uploadmultiple" enctype="multipart/form-data" method="POST">
            <input type="file" name="myFiles2" multiple>
            <input type="submit" value="Upload your files">
        </form>
        <hr>
    </div>

    <div class="container-fluid m-0 m-auto">
        <h3>Upload files (Use XHR)</h3>
        <!-- MULTIPLE FILES -->
        <input id="xhrFiles" type="file" name="xhrFiles" multiple>
        <button onclick="uploadFiles();">Upload file(s)</button>
        <progress id="progress1" min="0" max="100" value="0">0% complete</progress>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Post Json. postJson</h3>
        <button onclick="postJson();">Post Json</button>
        <div id="jsonResult" style="font-size: 1.2em; margin: 10px auto; width: 70%; height: 300px;"></div>
        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Ace editor sample (static code).</h3>
        <div id="editor" style="font-size: 1.2em; margin: 10px auto; width: 70%; height: 300px;"></div>
        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Ace editor sample (load code via XHR).</h3>
        <button onclick="getSampleJson();">Get json</button>
        <button onclick="getSampleJavaScript();">Get javascript</button>
        <br>
        <div id="jsonEd" style="font-size: 1.2em; margin: 10px auto; width: 70%; height: 300px;"></div>
        <hr>
    </div>

    <!-- JQuery -->
    <script src="/dist/js/jquery.min.js"></script>
    <!-- JQuery UI -->
    <script src="/dist/js/jquery-ui.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="/dist/js/popper.min.js"></script>
    <script src="/dist/js/tooltip.min.js"></script>
    <script src="/dist/js/bootstrap.min.js">/* bootstrap required jQuery and popperjs. */</script>
    <!-- Moment.js -->
    <script src="/dist/js/moment.min.js"></script>
    <!-- ace editor -->
    <script src="/dist/js/ace.js"></script>
    <script src="/dist/js/mode-html.js"></script>
    <script src="/dist/js/mode-json.js"></script>
    <script src="/dist/js/mode-javascript.js"></script>
    <!-- ace editor init -->
    <script>
        let editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/javascript");
        
        let src = 
`function foo(items) {
    var x = "All this is syntax highlighted";
    return x;
}`
        editor.session.setValue(src)
    </script>
    <!-- Riot.js -->
    <script src="/dist/js/riot.min.js"></script>
    <!-- Riot.js components -->
    <!--
    <script src="public/dist/components/riot/tags.js"></script>
    -->
    <!-- nlib -->
    <script src="dist/js/nlib.js"></script>
    <!-- nlib test scripts -->
    <!--
    <script src="dist/js/timespan.js"></script>
    <script src="dist/js/datetime.js"></script>
    -->

    <!-- XHR test code -->
    <script>
        let jsonEd = ace.edit("jsonEd");
        jsonEd.setTheme("ace/theme/monokai");
        let jsonResult = ace.edit("jsonResult");
        jsonResult.setTheme("ace/theme/monokai");
        let getSampleJson = () => {
            XHR.get('/getJson', (data) => {
                jsonEd.session.setMode("ace/mode/json");
                let src = (data.result) ? JSON.stringify(data.result, null, 4) : '';
                jsonEd.session.setValue(src)
            })
        }
        let getSampleJavaScript = () => {
            XHR.get('/getJavaScript', (data) => {
                jsonEd.session.setMode("ace/mode/javascript");                
                let src = (data.result) ? data.result : '';
                jsonEd.session.setValue(src)
            })
        }
        let postJson = () => {
            let obj = {
                name: 'joe',
                age: 45,
                updated: Date.now()
            }
            XHR.postJson('/postJson', obj, (data) => {
                jsonResult.session.setMode("ace/mode/json");
                let src = (data.result) ? JSON.stringify(data.result, null, 4) : '';
                
                jsonResult.session.setValue(src)
            })
        }
        let img = document.getElementById('img1');
        let images = [
            { url: '/public/assets/images/gif/emoji/normal/emo-n-01.gif', src: '' },
            { url: '/public/assets/images/png/fruits/apple.png', src: '' },
            { url: '/public/assets/images/backgrounds/bg-01.jpg', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-01.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-02.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-03.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-04.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-05.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-06.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-07.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-08.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-09.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-10.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-11.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-12.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-13.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-14.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-15.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-16.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-17.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-18.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-19.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-20.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-21.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-22.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-23.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-24.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-25.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-26.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-27.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-28.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-29.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-30.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-31.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-32.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-33.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-34.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-35.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-36.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-37.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-38.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-39.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-40.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-41.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-42.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-43.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-44.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-45.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-46.gif', src: '' },
            { url: '/public/assets/images/gif/emoji/transparent/emo-nt-47.gif', src: '' },
        ]

        let findImage = (url) => {
            let urls = images.map((oImg) => { return oImg.url.toLowerCase() })
            let idx = urls.indexOf(url.toLowerCase())
            let obj = null;
            if (idx !== -1) {
                obj = images[idx];
            }
            else {
                obj = { url: url, scr: '' }
                images.push(obj)
            }            
            return obj;
        }

        img.onload = function(e) {
            if (img.src && img.src.startsWith('blob:')) {
                console.log('revoke exist image')
                URL.revokeObjectURL(img.src); // Clean up after yourself.
            }
        }

        let getImage = (index) => {
            
            let url = images[index].url;
            let obj = findImage(url);
            if (!obj) {
                console.log('find image error!');
                return;
            }
            if (obj.src) {
                let src = URL.createObjectURL(obj.src);
                img.src = src;
            }
            else {
                XHR.getFile(url, (data) => {
                    if (data.result) {
                        obj.src = data.result;
                        let src = URL.createObjectURL(obj.src);
                        img.src = src;
                    }
                })
            }
        }

        let files = [];
        let xhrFiles = document.getElementById('xhrFiles')
        xhrFiles.addEventListener('change', (e) => {
            files = xhrFiles.files;
        }, false);
        let progress1 = document.getElementById('progress1')

        let clearFileInput = () => {
            xhrFiles.type = 'text'
            xhrFiles.value = '';
            xhrFiles.type = 'file'
            progress1.value = 0;
            progress1.textContent = '0% complete'
        }

        let uploadFiles = () => {
            XHR.sendFiles('/uploadmultiple', files, 
            (progressInfo) => {
                progress1.value = progressInfo.result;
                progress1.textContent = progressInfo.result.toString() + '% complete'; // Fallback for unsupported browsers.
            },
            () => {
                clearFileInput();
            })
        }

        let userStatus = document.getElementById('userStatus')
        let userName = document.getElementById('userName')
        let passWord = document.getElementById('passWord')
        
        let userInfo = () => {
            let status = 'status: none';
            userStatus.textContent = status;
        }
        let userRegister = () => {
            let status = 'status: ';            
            let user = { username: userName.value, password: passWord.value }
            console.log('input:', user)
            XHR.postJson('/users/register', user, (data) => {
                status = status + data.result.message;
                userStatus.textContent = status;
            })            
        }
        let userSignIn = () => {
            let status = 'status: ';
            let user = { username: userName.value, password: passWord.value }
            console.log('input:', user)
            XHR.postJson('/users/signin', user, (data) => {
                status = status + data.result.message;
                userStatus.textContent = status;
                console.log(data.result.user)
            })            
        }
        let userSignOut = () => {
            let status = 'status: ';
            let user = { username: userName.value, password: passWord.value }
            console.log('input:', user)
            XHR.postJson('/users/signout', user, (data) => {
                status = status + data.result.message;
                userStatus.textContent = status;
                console.log(data.result.user)
            })            
        }

        userInfo();
        
        let deviceStatus = document.getElementById('deviceStatus')
        let deviceInfo = () => {
            let status = 'status: none';
            deviceStatus.textContent = status;
        }
        let deviceRegister = () => {
            let status = 'status: ';
            deviceStatus.textContent = status;
        }
        let deviceSignIn = () => {
            let status = 'status: ';
            deviceStatus.textContent = status;
        }
        let deviceSignOut = () => {
            let status = 'status: ';
            deviceStatus.textContent = status;
        }

        deviceInfo();
    </script>

    <!-- page custom script -->
    <script>
        //riot.mount('app', { text: 'XXX' })
        //nlib.nav.gotoUrl('/')
    </script>
</body>
</html>