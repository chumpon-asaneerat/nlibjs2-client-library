<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>Home Page.</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/ico" href="public/favicon.ico"/>

    <!-- Font Awesome -->
    <link href="/dist/css/fontawesome.all.min.css" rel="stylesheet" type="text/css" />
    <!-- JQuery UI -->
    <link href="/dist/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
    <!-- Bootstrap 4 -->
    <link href="/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/dist/css/bootstrap-grid.min.css" rel="stylesheet" type="text/css" />
    <link href="/dist/css/bootstrap-reboot.min.css" rel="stylesheet" type="text/css" />
    <!-- Flag and Emoji icons -->
    <link href="/dist/css/flag-icon.min.css" rel="stylesheet" type="text/css" />
    <link href="/dist/css/emojisymbol.min.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <div class="container-fluid m-0 m-auto">
        <h3>Font awesome sample</h3>
        <p><i class="fas fa-arrow-right">&nbsp;&nbsp;</i>Sample icon</p>
        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Load image from static route</h3>
        <br>
        <br>
        <img src="/public/images/gif/emoji/transparent/emo-nt-01.gif" 
            height="auto" width="auto" 
            style="display: block; margin-left: auto; margin-right: auto;">
        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Load image from XHR</h3>
        <button onclick="getImage(0);">Get image 1</button>
        <button onclick="getImage(1);">Get image 2</button>
        <button onclick="getImage(2);">Get image 3</button>
        <br>
        <br>
        <img id="img1" src="" 
            height="150px" width="auto" 
            style="display: block; margin-left: auto; margin-right: auto;">

        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Upload files (Use multipart/form-data)</h3>
        <!-- MULTIPLE FILES -->
        <form action="/uploadmultiple" enctype="multipart/form-data" method="POST">
            <input type="file" name="myFiles2" multiple>
            <input type="submit" value="Upload your files">
        </form>
        <hr>
    </div>

    <div class="container-fluid m-0 m-auto">
        <h3>Upload files (Use XHR)</h3>
        <!-- MULTIPLE FILES -->
        <input id="xhrFiles" type="file" name="xhrFiles" multiple>
        <button onclick="uploadFiles();">Upload file(s)</button>
        <progress id="progress1" min="0" max="100" value="0">0% complete</progress>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Post Json. postJson</h3>
        <button onclick="postJson();">Post Json</button>
        <div id="jsonResult" style="font-size: 1.2em; margin: 10px auto; width: 70%; height: 300px;"></div>
        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Ace editor sample (static code).</h3>
        <div id="editor" style="font-size: 1.2em; margin: 10px auto; width: 70%; height: 300px;"></div>
        <hr>
    </div>

    <br>
    <div class="container-fluid m-0 m-auto">
        <h3>Ace editor sample (load code via XHR).</h3>
        <button onclick="getSampleJson();">Get json</button>
        <button onclick="getSampleJavaScript();">Get javascript</button>
        <br>
        <div id="jsonEd" style="font-size: 1.2em; margin: 10px auto; width: 70%; height: 300px;"></div>
        <hr>
    </div>

    <!-- JQuery -->
    <script src="/dist/js/jquery.min.js"></script>
    <!-- JQuery UI -->
    <script src="/dist/js/jquery-ui.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="/dist/js/popper.min.js"></script>
    <script src="/dist/js/tooltip.min.js"></script>
    <script src="/dist/js/bootstrap.min.js">/* bootstrap required jQuery and popperjs. */</script>
    <!-- Moment.js -->
    <script src="/dist/js/moment.min.js"></script>
    <!-- ace editor -->
    <script src="/dist/js/ace.js"></script>
    <script src="/dist/js/mode-html.js"></script>
    <script src="/dist/js/mode-json.js"></script>
    <script src="/dist/js/mode-javascript.js"></script>
    <!-- ace editor init -->
    <script>
        let editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/javascript");
        
        let src = 
`function foo(items) {
    var x = "All this is syntax highlighted";
    return x;
}`
        editor.session.setValue(src)
    </script>
    <!-- Riot.js -->
    <script src="/dist/js/riot.min.js"></script>
    <!-- Riot.js components -->
    <!--
    <script src="public/dist/components/riot/tags.js"></script>
    -->
    <!-- nlib -->
    <script src="dist/js/nlib.js"></script>
    <!-- nlib test scripts -->
    <!--
    <script src="dist/js/timespan.js"></script>
    <script src="dist/js/datetime.js"></script>
    -->

    <!-- XHR test code -->
    <script>
        let jsonEd = ace.edit("jsonEd");
        jsonEd.setTheme("ace/theme/monokai");
        let jsonResult = ace.edit("jsonResult");
        jsonResult.setTheme("ace/theme/monokai");
        let getSampleJson = () => {
            XHR.get('/getJson', (data) => {
                jsonEd.session.setMode("ace/mode/json");
                let src = (data.result) ? data.result : '';
                jsonEd.session.setValue(src)
            })
        }
        let getSampleJavaScript = () => {
            XHR.get('/getJavaScript', (data) => {
                jsonEd.session.setMode("ace/mode/javascript");                
                let src = (data.result) ? data.result : '';
                jsonEd.session.setValue(src)
            })
        }
        let postJson = () => {
            let obj = {
                name: 'joe',
                age: 45,
                updated: Date.now()
            }
            XHR.postJson('/postJson', obj, (data) => {                
                jsonResult.session.setMode("ace/mode/json");
                let src = (data.result) ? data.result : '';
                
                jsonResult.session.setValue(src)
            })
        }
        let img = document.getElementById('img1');
        let images = [
            { url: '/public/images/gif/emoji/normal/emo-n-01.gif', src: '' },
            { url: '/public/images/png/fruits/apple.png', src: '' },
            { url: '/public/images/backgrounds/bg-01.jpg', src: '' }
        ]

        let findImage = (url) => {
            let urls = images.map((oImg) => { return oImg.url.toLowerCase() })
            let idx = urls.indexOf(url.toLowerCase())
            let obj = null;
            if (idx !== -1) {
                obj = images[idx];
            }
            else {
                obj = { url: url, scr: '' }
                images.push(obj)
            }            
            return obj;
        }

        img.onload = function(e) {
            if (img.src && img.src.startsWith('blob:')) {
                console.log('revoke exist image')
                URL.revokeObjectURL(img.src); // Clean up after yourself.
            }
        }

        let getImage = (index) => {
            
            let url = images[index].url;
            let obj = findImage(url);
            if (!obj) {
                console.log('find image error!');
                return;
            }
            if (obj.src) {
                let src = URL.createObjectURL(obj.src);
                img.src = src;
            }
            else {
                XHR.getFile(url, (data) => {
                    if (data.result) {
                        obj.src = data.result;
                        let src = URL.createObjectURL(obj.src);
                        img.src = src;
                    }
                })
            }
        }

        let files = [];
        let xhrFiles = document.getElementById('xhrFiles')
        xhrFiles.addEventListener('change', (e) => {
            files = xhrFiles.files;
        }, false);
        let progress1 = document.getElementById('progress1')

        let clearFileInput = () => {
            xhrFiles.type = 'text'
            xhrFiles.value = '';
            xhrFiles.type = 'file'
            progress1.value = 0;
            progress1.textContent = '0% complete'
        }

        let uploadFiles = () => {
            XHR.sendFiles('/uploadmultiple', files, 
            (progressInfo) => {
                progress1.value = progressInfo.result;
                progress1.textContent = progressInfo.result.toString() + '% complete'; // Fallback for unsupported browsers.
            },
            () => {
                clearFileInput();
            })
        }
    </script>

    <!-- page custom script -->
    <script>
        //riot.mount('app', { text: 'XXX' })
        //nlib.nav.gotoUrl('/')
    </script>
</body>
</html>